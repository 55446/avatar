
### recalc

SAT_recalc_council_support = {
	set_temp_variable = { support_temp = SAT_council_member_1 }
	add_to_temp_variable = { support_temp = SAT_council_member_2 }
	add_to_temp_variable = { support_temp = SAT_council_member_3 }
	add_to_temp_variable = { support_temp = SAT_council_member_4 }
	add_to_temp_variable = { support_temp = SAT_council_member_5 }
	divide_temp_variable = { support_temp = 5}
	round_temp_variable = support_temp
	if = {
		limit = { check_variable = { support_temp > 0 } }
		clamp_temp_variable = {
			var = support_temp
			min = 1
			max = 5
		}
	}
	else = { set_temp_variable = { support_temp = 1 } }
	set_variable = { sat_current_council_symbol_frame = support_temp }
	set_variable = { SAT_council_support = support_temp }
	set_variable = { sat_current_member_1_frame = SAT_council_member_1 }
	set_variable = { sat_current_member_2_frame = SAT_council_member_2 }
	set_variable = { sat_current_member_3_frame = SAT_council_member_3 }
	set_variable = { sat_current_member_4_frame = SAT_council_member_4 }
	set_variable = { sat_current_member_5_frame = SAT_council_member_5 }
	SAT_recalc_council_spirit = yes
}

SAT_recalc_council_spirit = {
	if {
		limit = { check_variable = { SAT_council_support = 1 }}
		swap_ideas = {
			remove_idea = council_opposition
			add_idea = council_harsh_opposition
		}
	}
	if {
		limit = { check_variable = { SAT_council_support = 2 }}
		if {
			limit = { has_idea = council_harsh_opposition }
			swap_ideas = {
				remove_idea = council_harsh_opposition
				add_idea = council_opposition
			}
		} else if {
			limit = { has_idea = council_neutral}
			swap_ideas = {
				remove_idea = council_neutral
				add_idea = council_opposition
			}
		}
	}
	if {
		limit = { check_variable = { SAT_council_support = 3 }}
		if {
			limit = { has_idea = council_opposition }
			swap_ideas = {
				remove_idea = council_opposition
				add_idea = council_neutral
			}
		} else if {
			limit = { has_idea = council_support}
			swap_ideas = {
				remove_idea = council_support
				add_idea = council_neutral
			}
		}
	}
	if {
		limit = { check_variable = { SAT_council_support = 4 }}
		if {
			limit = { has_idea = council_neutral }
			swap_ideas = {
				remove_idea = council_neutral
				add_idea = council_support
			}
		} else if {
			limit = { has_idea = council_substancial_support}
			swap_ideas = {
				remove_idea = council_substancial_support
				add_idea = council_support
			}
		}
	}
	if {
		limit = { check_variable = { SAT_council_support = 5 }}
		swap_ideas = {
			remove_idea = council_support
			add_idea = council_substancial_support
		}
	}
}

### type of mission generator

SAT_mission_type_generator = {
	set_temp_variable = { max_probability = 1 }
	add_to_temp_variable = { max_probability = SAT_council_army }
	add_to_temp_variable = { max_probability = SAT_council_navy }
	add_to_temp_variable = { max_probability = SAT_council_air }
	add_to_temp_variable = { max_probability = SAT_council_research }
	add_to_temp_variable = { max_probability = SAT_council_construction }
	add_to_temp_variable = { max_probability = SAT_council_politics }
	
	randomize_temp_variable = {
		var = probability_temp
		distribution = uniform
		min = 1
		max = max_probability
	}
	round_temp_variable = probability_temp
	set_variable = { SAT_mission_type = 1 }
	subtract_from_temp_variable = { probability_temp = SAT_council_army }
	if {
		limit = { check_variable = { probability_temp > 0} }
		set_variable = { SAT_mission_type = 2}
	}
	subtract_from_temp_variable = { probability_temp = SAT_council_navy }
	if {
		limit = { check_variable = { probability_temp > 0} }
		set_variable = { SAT_mission_type = 3}
	subtract_from_temp_variable = { probability_temp = SAT_council_air }
	}
	if {
		limit = { check_variable = { probability_temp > 0} }
		set_variable = { SAT_mission_type = 4}
	subtract_from_temp_variable = { probability_temp = SAT_council_research }
	}
	if {
		limit = { check_variable = { probability_temp > 0} }
		set_variable = { SAT_mission_type = 5}
	}
	subtract_from_temp_variable = { probability_temp = SAT_council_construction }
	if {
		limit = { check_variable = { probability_temp > 0} }
		set_variable = { SAT_mission_type = 6}
	}
}


SAT_generate_specific_mission = {
	if {
		limit = { check_variable = { SAT_mission_type = 1}}
		set_variable = { SAT_specific_mission = 1 }
	}
	if {
		limit = { check_variable = { SAT_mission_type = 2}}
		set_variable = { SAT_specific_mission = 2 }
	}
	if {
		limit = { check_variable = { SAT_mission_type = 3}}
		set_variable = { SAT_specific_mission = 3 }
	}
	if {
		limit = { check_variable = { SAT_mission_type = 4}}
		set_variable = { SAT_specific_mission = 4 }
	}
	if {
		limit = { check_variable = { SAT_mission_type = 5}}
		set_variable = { SAT_specific_mission = 5 }
	}
	if {
		limit = { check_variable = { SAT_mission_type = 6}}
		set_variable = { SAT_specific_mission = 6 }
	}
}

SAT_generate_missions = {
	SAT_mission_type_generator = yes
	SAT_generate_specific_mission = yes
	set_variable = { SAT_mission_1 = SAT_specific_mission }
	
	SAT_mission_type_generator = yes
	SAT_generate_specific_mission = yes
	set_variable = { SAT_mission_2 = SAT_specific_mission }
	
	SAT_mission_type_generator = yes
	SAT_generate_specific_mission = yes
	set_variable = { SAT_mission_3 = SAT_specific_mission }
	
	SAT_mission_type_generator = yes
	SAT_generate_specific_mission = yes
	set_variable = { SAT_mission_4 = SAT_specific_mission }
}

SAT_start_mission {
	# find out what mission was choosen
	if {
		limit = { check_variable = { SAT_choosen_mission = 1 }}
		set_temp_variable = { sat_new_mission = SAT_mission_1 }
	}
	if {
		limit = { check_variable = { SAT_choosen_mission = 2 }}
		set_temp_variable = { sat_new_mission = SAT_mission_2 }
	}
	if {
		limit = { check_variable = { SAT_choosen_mission = 3 }}
		set_temp_variable = { sat_new_mission = SAT_mission_3 }
	}
	if {
		limit = { check_variable = { SAT_choosen_mission = 4 }}
		set_temp_variable = { sat_new_mission = SAT_mission_4 }
	}
	
	# add country flag to start mission
	if {
		limit = { check_variable = { sat_new_mission = 1 }}
		set_country_flag = SAT_mission_nr1
	}
}

##### council support calculations

SAT_council_small_support = {
	randomize_temp_variable = {
		var = temp_member
		distribution = uniform
		min = 1
		max = 6
	}
	round_temp_variable = temp_member
	if {
		limit = { 
			AND = {
				check_variable = { temp_member = 1 }
				check_variable = { SAT_council_member_1 < 5 }
				}
			}
		add_to_variable = { SAT_council_member_1 = 1 }
	}
	if {
		limit = { 
			AND = {
				check_variable = { temp_member = 2 }
				check_variable = { SAT_council_member_2 < 5 }
				}
			}
		add_to_variable = { SAT_council_member_2 = 1 }
	}
	if {
		limit = { 
			AND = {
				check_variable = { temp_member = 3 }
				check_variable = { SAT_council_member_3 < 5 }
				}
			}
		add_to_variable = { SAT_council_member_3 = 1 }
	}
	if {
		limit = { 
			AND = {
				check_variable = { temp_member = 4 }
				check_variable = { SAT_council_member_4 < 5 }
				}
			}
		add_to_variable = { SAT_council_member_4 = 1 }
	}
	if {
		limit = { 
			AND = {
				check_variable = { temp_member = 5 }
				check_variable = { SAT_council_member_5 < 5 }
				}
			}
		add_to_variable = { SAT_council_member_5 = 1 }
	}
	SAT_recalc_council_support = yes
}

SAT_council_small_opposition = {
	randomize_temp_variable = {
		var = temp_member
		distribution = uniform
		min = 1
		max = 5.5
	}
	round_temp_variable = temp_member
	if {
		limit = { 
			AND = {
				check_variable = { temp_member = 1 }
				check_variable = { SAT_council_member_1 > 1 }
				}
			}
		subtract_from_variable = { SAT_council_member_1 = 1 }
	}
	if {
		limit = { 
			AND = {
				check_variable = { temp_member = 2 }
				check_variable = { SAT_council_member_2 > 1 }
				}
			}
		subtract_from_variable = { SAT_council_member_2 = 1 }
	}
	if {
		limit = { 
			AND = {
				check_variable = { temp_member = 3 }
				check_variable = { SAT_council_member_3 > 1 }
				}
			}
		subtract_from_variable = { SAT_council_member_3 = 1 }
	}
	if {
		limit = { 
			AND = {
				check_variable = { temp_member = 4 }
				check_variable = { SAT_council_member_4 > 1 }
				}
			}
		subtract_from_variable = { SAT_council_member_4 = 1 }
	}
	if {
		limit = { 
			AND = {
				check_variable = { temp_member = 5 }
				check_variable = { SAT_council_member_5 > 1 }
				}
			}
		subtract_from_variable = { SAT_council_member_5 = 1 }
	}
	SAT_recalc_council_support = yes
}

SAT_council_medium_support = {
	SAT_council_small_support = yes
	SAT_council_small_support = yes
}

SAT_council_medium_opposition = {
	SAT_council_small_opposition = yes
	SAT_council_small_opposition = yes
}

SAT_council_large_support = {
	SAT_council_small_support = yes
	SAT_council_small_support = yes
	SAT_council_small_support = yes
	SAT_council_small_support = yes
}

SAT_council_large_opposition = {
	SAT_council_small_opposition = yes
	SAT_council_small_opposition = yes
	SAT_council_small_opposition = yes
	SAT_council_small_opposition = yes
}

SAT_council_extreme_support = {
	if {
		limit = { check_variable = { SAT_council_member_1 < 5 }}
		add_to_variable = { SAT_council_member_1 = 1}
	}
	if {
		limit = { check_variable = { SAT_council_member_2 < 5 }}
		add_to_variable = { SAT_council_member_2 = 1}
	}
	if {
		limit = { check_variable = { SAT_council_member_3 < 5 }}
		add_to_variable = { SAT_council_member_3 = 1}
	}
	if {
		limit = { check_variable = { SAT_council_member_4 < 5 }}
		add_to_variable = { SAT_council_member_4 = 1}
	}
	if {
		limit = { check_variable = { SAT_council_member_5 < 5 }}
		add_to_variable = { SAT_council_member_5 = 1}
	}
	SAT_recalc_council_support = yes
}

SAT_council_extreme_opposition = {
	if {
		limit = { check_variable = { SAT_council_member_1 > 1 }}
		subtract_from_variable = { SAT_council_member_1 = 1}
	}
	if {
		limit = { check_variable = { SAT_council_member_2 > 1 }}
		subtract_from_variable = { SAT_council_member_2 = 1}
	}
	if {
		limit = { check_variable = { SAT_council_member_3 > 1 }}
		subtract_from_variable = { SAT_council_member_3 = 1}
	}
	if {
		limit = { check_variable = { SAT_council_member_4 > 1 }}
		subtract_from_variable = { SAT_council_member_4 = 1}
	}
	if {
		limit = { check_variable = { SAT_council_member_5 > 1 }}
		subtract_from_variable = { SAT_council_member_5 = 1}
	}
	SAT_recalc_council_support = yes
}