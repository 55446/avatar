

ration_distribution = {

	set_variable = { total_low_priority = 0 }
	set_variable = { total_medium_priority = 0 }
	set_variable = { total_high_priority = 0 }

	if = {
		limit = {	
			check_variable = { 1_low_prio_var > 1 }
		}
		add_to_variable = { total_low_priority = 1 }
	}
	if = {
		limit = {	
			check_variable = { 2_low_prio_var > 1 }
		}
		add_to_variable = { total_low_priority = 1 }
	}
	if = {
		limit = {	
			check_variable = { 3_low_prio_var > 1 }
		}
		add_to_variable = { total_low_priority = 1 }
	}
	if = {
		limit = {	
			check_variable = { 4_low_prio_var > 1 }
		}
		add_to_variable = { total_low_priority = 1 }
	}

	if = {
		limit = {	
			check_variable = { 1_medium_prio_var > 1 }
		}
		add_to_variable = { total_medium_priority = 1 }
	}
	if = {
		limit = {	
			check_variable = { 2_medium_prio_var > 1 }
		}
		add_to_variable = { total_medium_priority = 1 }
	}
	if = {
		limit = {	
			check_variable = { 3_medium_prio_var > 1 }
		}
		add_to_variable = { total_medium_priority = 1 }
	}
	if = {
		limit = {	
			check_variable = { 4_medium_prio_var > 1 }
		}
		add_to_variable = { total_medium_priority = 1 }
	}

	if = {
		limit = {	
			check_variable = { 1_high_prio_var > 1 }
		}
		add_to_variable = { total_high_priority = 1 }
	}
	if = {
		limit = {	
			check_variable = { 2_high_prio_var > 1 }
		}
		add_to_variable = { total_high_priority = 1 }
	}
	if = {
		limit = {	
			check_variable = { 3_high_prio_var > 1 }
		}
		add_to_variable = { total_high_priority = 1 }
	}
	if = {
		limit = {	
			check_variable = { 4_high_prio_var > 1 }
		}
		add_to_variable = { total_high_priority = 1 }
	}

	clamp_variable = { 
		var = total_low_priority 
		min = 1
	}
	clamp_variable = { 
		var = total_medium_priority 
		min = 1
	}
	clamp_variable = { 
		var = total_high_priority 
		min = 1
	}

	set_variable = { total_ration_priority = 0 }

	add_to_variable = { total_ration_priority = 1_priority_var }
	add_to_variable = { total_ration_priority = 2_priority_var }
	add_to_variable = { total_ration_priority = 3_priority_var }
	add_to_variable = { total_ration_priority = 4_priority_var }


	set_variable = { 1_priority_factor = 1_priority_var }
	set_variable = { 2_priority_factor = 2_priority_var }
	set_variable = { 3_priority_factor = 3_priority_var }
	set_variable = { 4_priority_factor = 4_priority_var }

	divide_variable = { 1_priority_factor = total_ration_priority }
	divide_variable = { 2_priority_factor = total_ration_priority }
	divide_variable = { 3_priority_factor = total_ration_priority }
	divide_variable = { 4_priority_factor = total_ration_priority }

	set_variable = { total_mh_factor = total_medium_priority }
	add_to_variable = { total_mh_factor = total_high_priority }

	if = {
		limit = {	
			check_variable = { total_mh_factor = 0 }
		}
		set_variable = { total_mh_factor = 1 }
	}

	set_variable = { total_medium_factor = total_medium_priority }
	divide_variable = { total_medium_factor = total_mh_factor }
	divide_variable = { total_medium_factor = 2 }

	set_variable = { total_high_factor = 1 }
	subtract_from_variable = { total_high_factor = total_medium_factor }

	#divide_variable = { 1_priority_factor = 4 }
	#divide_variable = { 2_priority_factor = 4 }
	#divide_variable = { 3_priority_factor = 4 }
	#divide_variable = { 4_priority_factor = 4 }
}

civil_factory_output = {

	if = {
		limit = {
			check_variable = { civil_capacity < ic }
		}
		ROOT = {
			add_offsite_building = { type = industrial_complex level = 1 }
		}
		add_to_variable = { civil_capacity = 1 }
		civil_factory_output = yes
	}
	if = {
		limit = {
			check_variable = { civil_capacity > ic }
		}
		ROOT = {
			add_offsite_building = { type = industrial_complex level = -1 }
		}
		add_to_variable = { civil_capacity = -1 }
		civil_factory_output = yes
	}
	
}

extra_factory_output = {

	if = {
		limit = {
			check_variable = { extra_mils < factory_duplicator }
		}
		ROOT = {
			add_offsite_building = { type = arms_factory level = 1 }
		}
		add_to_variable = { extra_mils = 1 }
		extra_factory_output = yes
	}
	if = {
		limit = {
			check_variable = { extra_mils > factory_duplicator }
		}
		ROOT = {
			add_offsite_building = { type = arms_factory level = -1 }
		}
		add_to_variable = { extra_mils = -1 }
		extra_factory_output = yes
	}
	
}

extra_dockyard_output = {

	if = {
		limit = {
			check_variable = { extra_docks < dockyard_count }
		}
		ROOT = {
			add_offsite_building = { type = harbour level = 1 }
		}
		add_to_variable = { extra_docks = 1 }
		extra_dockyard_output = yes
	}
	if = {
		limit = {
			check_variable = { extra_docks > dockyard_count }
		}
		ROOT = {
			add_offsite_building = { type = harbour level = -1 }
		}
		add_to_variable = { extra_docks = -1 }
		extra_dockyard_output = yes
	}
	
}

add_farm_random = {
	if = {
		limit = {
			has_country_flag = core_all_construction_flag
		}
		random_owned_state = {
			limit = {
				free_building_slots = {
					building = farm
					size > 0
					include_locked = no
				}
				check_variable = { field > 0 }
			}
			add_building_construction = {
				type = farm
				level = 1
				instant_build = no
			}
		}
	}
	else = {
		random_owned_state = {
			limit = {
				free_building_slots = {
					building = farm
					size > 0
					include_locked = no
				}
				is_core_of = ROOT
				check_variable = { field > 0 }
			}
			add_building_construction = {
				type = farm
				level = 1
				instant_build = no
			}
		}
	}
}


add_mill_random = {
	if = {
		limit = {
			has_country_flag = core_all_construction_flag
		}
		random_owned_state = {
			limit = {
				free_building_slots = {
					building = mill
					size > 0
					include_locked = no
				}
			}
			add_building_construction = {
				type = mill
				level = 1
				instant_build = no
			}
		}
	}
	else = {
		random_owned_state = {
			limit = {
				free_building_slots = {
					building = mill
					size > 0
					include_locked = no
				}
				is_core_of = ROOT
			}
			add_building_construction = {
				type = mill
				level = 1
				instant_build = no
			}
		}
	}
}

add_fishing_stand_random = {
	if = {
		limit = {
			has_country_flag = core_all_construction_flag
		}
		random_owned_state = {
			limit = {
				free_building_slots = {
					building = fishing_stand
					size > 0
					include_locked = no
				}
				check_variable = { water > 0 }
			}
			add_building_construction = {
				type = fishing_stand
				level = 1
				instant_build = no
			}
		}
	}
	else = {
		random_owned_state = {
			limit = {
				free_building_slots = {
					building = fishing_stand
					size > 0
					include_locked = no
				}
				is_core_of = ROOT
				check_variable = { water > 0 }
			}
			add_building_construction = {
				type = fishing_stand
				level = 1
				instant_build = no
			}
		}
	}
}
add_ranch_random = {
	if = {
		limit = {
			has_country_flag = core_all_construction_flag
		}
		random_owned_state = {
			limit = {
				free_building_slots = {
					building = ranch
					size > 0
					include_locked = no
				}
				check_variable = { animal > 0 }
			}
			add_building_construction = {
				type = ranch
				level = 1
				instant_build = no
			}
		}
	}
	else = {
		random_owned_state = {
			limit = {
				free_building_slots = {
					building = ranch
					size > 0
					include_locked = no
				}
				is_core_of = ROOT
				check_variable = { animal > 0 }
			}
			add_building_construction = {
				type = ranch
				level = 1
				instant_build = no
			}
		}
	}
}

add_lumber_mill_random = {
	if = {
		limit = {
			has_country_flag = core_all_construction_flag
		}
		random_owned_state = {
			limit = {
				free_building_slots = {
					building = lumber_mill
					size > 0
					include_locked = no
				}
				check_variable = { forest > 0 }
			}
			add_building_construction = {
				type = lumber_mill
				level = 1
				instant_build = no
			}
		}
	}
	else = {
		random_owned_state = {
			limit = {
				free_building_slots = {
					building = lumber_mill
					size > 0
					include_locked = no
				}
				is_core_of = ROOT
				check_variable = { forest > 0 }
			}
			add_building_construction = {
				type = lumber_mill
				level = 1
				instant_build = no
			}
		}
	}
}

add_quarry_random = {
	if = {
		limit = {
			has_country_flag = core_all_construction_flag
		}
		random_owned_state = {
			limit = {
				free_building_slots = {
					building = quarry
					size > 0
					include_locked = no
				}
				check_variable = { stonefield > 0 }
			}
			add_building_construction = {
				type = quarry
				level = 1
				instant_build = no
			}
		}
	}
	else = {
		random_owned_state = {
			limit = {
				free_building_slots = {
					building = quarry
					size > 0
					include_locked = no
				}
				is_core_of = ROOT
				check_variable = { stonefield > 0 }
			}
			add_building_construction = {
				type = quarry
				level = 1
				instant_build = no
			}
		}
	}
}

add_mine_random = {
	if = {
		limit = {
			has_country_flag = core_all_construction_flag
		}
		random_owned_state = {
			limit = {
				free_building_slots = {
					building = mine
					size > 0
					include_locked = no
				}
				check_variable = { mountain > 0}
			}
			add_building_construction = {
				type = mine
				level = 1
				instant_build = no
			}
		}
	}
	else = {
		random_owned_state = {
			limit = {
				free_building_slots = {
					building = mine
					size > 0
					include_locked = no
				}
				is_core_of = ROOT
				check_variable = { mountain > 0}
			}
			add_building_construction = {
				type = mine
				level = 1
				instant_build = no
			}
		}
	}
}

add_crop_weaving_random = {
	if = {
		limit = {
			has_country_flag = core_all_construction_flag
		}
		random_owned_state = {
			limit = {
				free_building_slots = {
					building = crop_weaving
					size > 0
					include_locked = no
				}
			}
			add_building_construction = {
				type = crop_weaving
				level = 1
				instant_build = no
			}
		}
	}
	else = {
		random_owned_state = {
			limit = {
				free_building_slots = {
					building = crop_weaving
					size > 0
					include_locked = no
				}
				is_core_of = ROOT
			}
			add_building_construction = {
				type = crop_weaving
				level = 1
				instant_build = no
			}
		}
	}
}

add_animal_weaving_random = {
	if = {
		limit = {
			has_country_flag = core_all_construction_flag
		}
		random_owned_state = {
			limit = {
				free_building_slots = {
					building = animal_weaving
					size > 0
					include_locked = no
				}
			}
			add_building_construction = {
				type = animal_weaving
				level = 1
				instant_build = no
			}
		}
	}
	else = {
		random_owned_state = {
			limit = {
				free_building_slots = {
					building = animal_weaving
					size > 0
					include_locked = no
				}
				is_core_of = ROOT
			}
			add_building_construction = {
				type = animal_weaving
				level = 1
				instant_build = no
			}
		}
	}
}

add_steelworks_random = {
	if = {
		limit = {
			has_country_flag = core_all_construction_flag
		}
		random_owned_state = {
			limit = {
				free_building_slots = {
					building = steelworks
					size > 0
					include_locked = no
				}
			}
			add_building_construction = {
				type = steelworks
				level = 1
				instant_build = no
			}
		}
	}
	else = {
		random_owned_state = {
			limit = {
				free_building_slots = {
					building = steelworks
					size > 0
					include_locked = no
				}
				is_core_of = ROOT
			}
			add_building_construction = {
				type = steelworks
				level = 1
				instant_build = no
			}
		}
	}
}

add_smithy_random = {
	if = {
		limit = {
			has_country_flag = core_all_construction_flag
		}
		random_owned_state = {
			limit = {
				free_building_slots = {
					building = arms_factory
					size > 0
					include_locked = no
				}
			}
			add_building_construction = {
				type = arms_factory
				level = 1
				instant_build = no
			}
		}
	}
	else = {
		random_owned_state = {
			limit = {
				free_building_slots = {
					building = arms_factory
					size > 0
					include_locked = no
				}
				is_core_of = ROOT
			}
			add_building_construction = {
				type = arms_factory
				level = 1
				instant_build = no
			}
		}
	}
}

add_factory_random = {
	if = {
		limit = {
			has_country_flag = core_all_construction_flag
		}
		random_owned_state = {
			limit = {
				free_building_slots = {
					building = factory
					size > 0
					include_locked = no
				}
			}
			add_building_construction = {
				type = factory
				level = 1
				instant_build = no
			}
		}
	}
	else = {
		random_owned_state = {
			limit = {
				free_building_slots = {
					building = factory
					size > 0
					include_locked = no
				}
				is_core_of = ROOT
			}
			add_building_construction = {
				type = factory
				level = 1
				instant_build = no
			}
		}
	}
}

add_harbour_random = {
	if = {
		limit = {
			has_country_flag = core_all_construction_flag
		}
		random_owned_state = {
			limit = {
				free_building_slots = {
					building = harbour
					size > 0
					include_locked = no
				}
				is_coastal = yes
			}
			add_building_construction = {
				type = harbour
				level = 1
				instant_build = no
			}
		}
	}
	else = {
		random_owned_state = {
			limit = {
				free_building_slots = {
					building = harbour
					size > 0
					include_locked = no
				}
				is_core_of = ROOT
				is_coastal = yes
			}
			add_building_construction = {
				type = harbour
				level = 1
				instant_build = no
			}
		}
	}
}

add_dockyard_random = {
	if = {
		limit = {
			has_country_flag = core_all_construction_flag
		}
		random_owned_state = {
			limit = {
				free_building_slots = {
					building = dockyard
					size > 0
					include_locked = no
				}
				is_coastal = yes
			}
			add_building_construction = {
				type = dockyard
				level = 1
				instant_build = no
			}
		}
	}
	else = {
		random_owned_state = {
			limit = {
				free_building_slots = {
					building = dockyard
					size > 0
					include_locked = no
				}
				is_core_of = ROOT
				is_coastal = yes
			}
			add_building_construction = {
				type = dockyard
				level = 1
				instant_build = no
			}
		}
	}
}

add_consumer_good_factory_random = {
	if = {
		limit = {
			has_country_flag = core_all_construction_flag
		}
		random_owned_state = {
			limit = {
				free_building_slots = {
					building = consumer_good_factory
					size > 0
					include_locked = no
				}
			}
			add_building_construction = {
				type = consumer_good_factory
				level = 1
				instant_build = no
			}
		}
	}
	else = {
		random_owned_state = {
			limit = {
				free_building_slots = {
					building = consumer_good_factory
					size > 0
					include_locked = no
				}
				is_core_of = ROOT
			}
			add_building_construction = {
				type = consumer_good_factory
				level = 1
				instant_build = no
			}
		}
	}
}

add_luxury_good_factory_random = {
	if = {
		limit = {
			has_country_flag = core_all_construction_flag
		}
		random_owned_state = {
			limit = {
				free_building_slots = {
					building = luxury_good_factory
					size > 0
					include_locked = no
				}
			}
			add_building_construction = {
				type = luxury_good_factory
				level = 1
				instant_build = no
			}
		}
	}
	else = {
		random_owned_state = {
			limit = {
				free_building_slots = {
					building = luxury_good_factory
					size > 0
					include_locked = no
				}
				is_core_of = ROOT
			}
			add_building_construction = {
				type = luxury_good_factory
				level = 1
				instant_build = no
			}
		}
	}
}

add_manufactory_random = {
	if = {
		limit = {
			has_country_flag = core_all_construction_flag
		}
		random_owned_state = {
			limit = {
				free_building_slots = {
					building = industrial_complex
					size > 0
					include_locked = no
				}
			}
			add_building_construction = {
				type = industrial_complex
				level = 1
				instant_build = no
			}
		}
	}
	else = {
		random_owned_state = {
			limit = {
				free_building_slots = {
					building = industrial_complex
					size > 0
					include_locked = no
				}
				is_core_of = ROOT
			}
			add_building_construction = {
				type = industrial_complex
				level = 1
				instant_build = no
			}
		}
	}
}

add_carpentry_random = {
	if = {
		limit = {
			has_country_flag = core_all_construction_flag
		}
		random_owned_state = {
			limit = {
				free_building_slots = {
					building = carpentry
					size > 0
					include_locked = no
				}
			}
			add_building_construction = {
				type = carpentry
				level = 1
				instant_build = no
			}
		}
	}
	else = {
		random_owned_state = {
			limit = {
				free_building_slots = {
					building = carpentry
					size > 0
					include_locked = no
				}
				is_core_of = ROOT
			}
			add_building_construction = {
				type = carpentry
				level = 1
				instant_build = no
			}
		}
	}
}

add_masonry_random = {
	if = {
		limit = {
			has_country_flag = core_all_construction_flag
		}
		random_owned_state = {
			limit = {
				free_building_slots = {
					building = masonry
					size > 0
					include_locked = no
				}
			}
			add_building_construction = {
				type = masonry
				level = 1
				instant_build = no
			}
		}
	}
	else = {
		random_owned_state = {
			limit = {
				free_building_slots = {
					building = masonry
					size > 0
					include_locked = no
				}
				is_core_of = ROOT
			}
			add_building_construction = {
				type = masonry
				level = 1
				instant_build = no
			}
		}
	}
}

add_steel_beam_factory_random = {
	if = {
		limit = {
			has_country_flag = core_all_construction_flag
		}
		random_owned_state = {
			limit = {
				free_building_slots = {
					building = steel_beam_factory
					size > 0
					include_locked = no
				}
			}
			add_building_construction = {
				type = steel_beam_factory
				level = 1
				instant_build = no
			}
		}
	}
	else = {
		random_owned_state = {
			limit = {
				free_building_slots = {
					building = steel_beam_factory
					size > 0
					include_locked = no
				}
				is_core_of = ROOT
			}
			add_building_construction = {
				type = steel_beam_factory
				level = 1
				instant_build = no
			}
		}
	}
}
