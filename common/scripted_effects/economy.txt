
extra_factory_output = {

	set_temp_variable = { factories_temp = factory_count }
	multiply_temp_variable = { factories_temp = 4 }
	set_variable = { factory_duplicator = factories_temp }
	if = {
		limit = {
			check_variable = { extra_mils < factory_duplicator }
		}
		ROOT = {
			add_offsite_building = { type = arms_factory level = 1 }
		}
		add_to_variable = { extra_mils = 1 }
	}
	else = {
		limit = {
			check_variable = { extra_mils > factory_duplicator }
		}
		ROOT = {
			add_offsite_building = { type = arms_factory level = -1 }
		}
		add_to_variable = { extra_mils = -1 }
	}
	
}

extra_dockyard_output = {

	set_temp_variable = { dockyards_temp = dockyard_count }
	#multiply_temp_variable = { dockyards_temp = 2 }
	set_variable = { dockyard_duplicator = dockyards_temp }
	if = {
		limit = {
			check_variable = { extra_docks < dockyard_count }
		}
		ROOT = {
			add_offsite_building = { type = harbour level = 1 }
		}
		add_to_variable = { extra_docks = 1 }
	}
	if = {
		limit = {
			check_variable = { extra_docks > dockyard_count }
		}
		ROOT = {
			add_offsite_building = { type = harbour level = -1 }
		}
		add_to_variable = { extra_docks = -1 }
	}
	
}


carpentry_construction = {

	THIS = {
		set_state_flag = carpentry_in_construction
		set_state_flag = construction
	}
	set_variable = { show_progress = -100 }
	set_variable = { required_ic = ROOT.carpentry_cost }
	add_to_variable = { ROOT.used_construction_capacity = 1 }

	set_variable = { planks_required = 54 }
	set_variable = { bricks_required = 26 }

	add_to_array = {
		array = ROOT.construction_sites
		value = state_id
	}
}
add_carpentry = {

	THIS = {
		add_building_construction = {
			type = carpentry
			level = 1
			instant_build = yes
		}

		clr_state_flag = carpentry_in_construction
		clr_state_flag = construction
		set_variable = { construction_ic = 0 }
	}
	add_to_variable = { urban_tiles_used = 1 }
	subtract_from_variable = { ROOT.used_construction_capacity = 1 }

	remove_from_array = {
		array = ROOT.construction_sites
		value = state_id
	}
	
}

construction_resource_calculation = {

	for_each_scope_loop = {
		array = ROOT.construction_sites
		break = break
		
		set_variable = { planks_gathered = planks_required }
		set_variable = { bricks_gathered = bricks_required }
		set_variable = { steel_beams_gathered = steel_beams_required }
		subtract_from_variable = { ROOT.planks = planks_gathered }
		subtract_from_variable = { ROOT.bricks = bricks_gathered }
		subtract_from_variable = { ROOT.steel_beams = steel_beams_gathered }
		if = {
			limit = {
				check_variable = {
					var = ROOT.planks
					value = 0
					compare = less_than_or_equals
				}
			}
			clear_temp_variable = break
		}
	}
}

cancel_construction = {

	THIS = {
		clr_state_flag = carpentry_in_construction
		clr_state_flag = construction
		set_variable = { construction_ic = 0 }
	}
	subtract_from_variable = { ROOT.used_construction_capacity = 1 }
	
}